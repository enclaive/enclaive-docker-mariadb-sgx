version: '2'

services:

  demo:
    image: demo/mariadb:latest
    build: .
    container_name: demo
    volumes:
      - "./data.sql:/data.sql"
      - "data:/vanilla/"
      - "sgx-data:/sgx/"
    entrypoint: tail -f /dev/null

  vanilla:
    image: demo/mariadb:latest
    build: .
    container_name: mariadb
    volumes:
      - "data:/var/lib/mysql/"

  sgx:
    image: enclaive/mariadb-sgx:latest
    container_name: mariadb-sgx
    devices:
      - "/dev/sgx/enclave:/dev/sgx/enclave"
      - "/dev/sgx/enclave:/dev/sgx_enclave"     # azure compatibility
      - "/dev/sgx_provision:/dev/sgx_provision"   
    volumes:
      - "sgx-data:/data/"

volumes:
  data:
  sgx-data:
